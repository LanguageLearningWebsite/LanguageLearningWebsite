<%= stylesheet_link_tag "quiz" %>

<%= form_for(@quiz_quiz, url: quiz_scope(@quiz_quiz), html: { class: 'quiz-form clearfix' }, validate: true) do |f| %>
  <div class='field'>
    <div class='row'>
      <div class='form-group col-sm-4'>
        <%= f.label :name %>
        <%= f.text_field :name, class: 'form-control' %>
      </div>
      <div class='form-group col-sm-4'>
        <%= f.label :attempts_number, 'Maximum number of attempts (0 is infinite)' %>
        <%= f.number_field :attempts_number, min: 0, class: 'form-control' %>
      </div>
      <div class='form-group col-sm-2'>
        <%= f.label :active %>
        <%= f.select :active, ['true', 'false'], {}, class: 'form-control', style: 'height: 1.25rem;' %>
      </div>
    </div>

    <div class='row'>
      <div class='form-group col-sm-10'>
        <%= f.label :description %>
        <%= f.text_area :description, size: '100x5', class: 'form-control', style: 'max-width: 100%;' %>
      </div>
    </div>

    <div class='appendable'>
      <%= f.fields_for :questions do |builder| %>
        <%= render 'question_fields', f: builder %>
      <% end %>
    </div>
    <br/>
    <%= link_to_add_field 'Add a new Question', f, :questions%>
  </div>
  <br/>
  <% if action_name =~ /edit|update/ %>
    <%= f.submit 'Update Quiz', class: 'pull-right btn btn-primary' %>
  <% else %>
    <%= f.submit 'Create Quiz', class: 'pull-right btn btn-primary' %>
  <% end %>
  <%= button_tag(type: 'button', class: 'pull-right cancel') do %>
    <%= link_to 'Cancel', "/admin/quiz_quizzes" %>
  <% end %>
<% end -%>

<script type='text/javascript'>
  // remove attachment field
  function removeField(link) {
    $(link).prev("input[type=hidden]").val("true");
    tag = $(link).closest(".field")
    tag.hide('slow');
  }
  // add attachment field
  function addField(link, association, content) {
    var new_id = new Date().getTime();
    var regexp = new RegExp("new_" + association, "g");
    var html = $(content.replace(regexp, new_id)).hide();
    var target = $(link).closest("div.field").find(".appendable").first();
    var last_height = 0
    html.appendTo(target).slideDown({
      duration: 'slow',
      progress: function () {
        delta = $(this).outerHeight(true) - last_height
        $(window).scrollTop( $(window).scrollTop() + delta );
        last_height = $(this).outerHeight(true);
      },
      complete: function () {
        $(this).find('input[type=text]').focus();
      }});
    }
</script>
