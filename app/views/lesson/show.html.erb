<%= stylesheet_link_tag "video-js" %>
<%= stylesheet_link_tag "custom-videojs-player" %>
<%= stylesheet_link_tag "videojs-transcript" %>
<%= stylesheet_link_tag "sidebar" %>

<% content_for(:body_attributes) do %>
  data-turbolinks="false"
<% end %>
<div id="wrapper">
  <!-- Sidebar -->
  <div id="sidebar-wrapper">
    <ul class="sidebar-nav">
      <li class="sidebar-brand">
        <a href="#">Lessons</a>
      </li>
      <% @lessons.each_with_index do |lesson, index| %>
        <% if lesson.header %>
          <% if index != 0 %></ul></li><% end %>
          <li class="dropdown">
          <a href="#" data-toggle="dropdown"><i class="fa fa-graduation-cap"> <%= lesson.title %></i><span class="caret"></span></a>
          <ul class="dropdown-menu" role="menu">
          <li class="dropdown-header" style="text-align: center";><i class="fa fa-angle-double-up fa-2x" aria-hidden="true"></i></li>
          <% else %>
          <li>
            <%= link_to [lesson.course, lesson], :"data-turbolinks" => false do %>
              <%= lesson.title %>
            <% end %>
          </li>
        <% end %>
      <% end %>
      <% if !@lessons.empty? %></ul></li><% end %>
    </ul>
  </div>
  <!-- /#sidebar-wrapper -->

  <!-- Page Content -->
  <div id="page-content-wrapper">
    <div class="row">
      <div class="col-md-1">
        <button type="button" class="hamburger is-closed" data-toggle="offcanvas">
          <span class="hamb-top"></span>
          <span class="hamb-middle"></span>
          <span class="hamb-bottom"></span>
        </button>
      </div>

      <div class="col-md-8 offset-md-1 mt-3 mb-3">
        <div class="card">
          <div class="card-header">
            <div class="row">
              <div class="col-md-3">
                <% if @prev_lesson %>
                  <%= link_to [@prev_lesson.course, @prev_lesson], class: "btn btn-secondary btn-md btn-block pull-left" do %>
                    <i class="fa fa-chevron-left" style="margin-right: 15px;" aria-hidden="true"></i>Previous
                  <% end %>
                <% else %>
                  <button class="btn btn-secondary btn-md btn-block pull-left disabled">
                    <i class="fa fa-chevron-left" style="margin-right: 15px;" aria-hidden="true"></i>Previous
                  </button>
                <% end %>
              </div>
              <div class="col-md-6">
                <h4 class="text-center"><%= @lesson.long_title %></h4>
              </div>
              <div class="col-md-3">
                <% if @next_lesson %>
                  <%= link_to [@next_lesson.course, @next_lesson], class: "btn btn-secondary btn-md btn-block pull-left" do %>
                    Next<i class="fa fa-chevron-right" style="margin-left: 15px;" aria-hidden="true"></i>
                  <% end %>
                <% else %>
                  <button class="btn btn-secondary btn-md btn-block pull-right disabled">
                    Next<i class="fa fa-chevron-right" style="margin-left: 15px;" aria-hidden="true"></i>
                  </button>
                <% end %>
              </div>
            </div>
          </div>
          <div class="card-block">
            <div class="main-player">
              <div class="video-container width-100">
                <video crossdomain id="video1" class="video-js vjs-default-skin" controls preload="auto" data-setup='{"playbackRates": [0.5, 1, 1.5, 2], "fluid": true}'>
                  <source src="<%= @lesson.video %>" type="video/mp4" />
                  <track id="EN-Chinese" label="EN-Chinese" kind="captions" srclang="zh-Hans" src="/assets/subtitles/EL-Chinese.vtt">
                  <track id="pinyin" label="pinyin" kind="captions" srclang="zh-Hans" src="/assets/subtitles/pinyin.vtt">
                  <track id="simplified-characters" label="simplified-characters" kind="captions" srclang="zh-Hans" src="/assets/subtitles/simplified-characters.vtt">
                  <track id="English" label="English" kind="captions" srclang="zh-Hans" src="/assets/subtitles/English.vtt">
                  <p class="vjs-no-js">
                    To view this video please enable JavaScript, and consider upgrading to a web browser that
                    <a href="http://videojs.com/html5-video-support/" target="_blank">supports HTML5 video</a>
                  </p>
                </video>
              </div>
              <div class="transcript-container width-35">
                <div class="vjs-transcript" id="transcript"></div>
              </div>
            </div>
            <div id="subtitle-display-1" class="subtitle-display width-100"></div>
            <div id="subtitle-display-2" class="subtitle-display width-100"></div>
          </div>
        </div>
      </div>
    </div>
  </div>
  <!-- /#page-content-wrapper -->
</div>
<!-- /#wrapper -->

<script type="text/javascript">
  setTimeout(function () {
    updateTranscript('video1');
    updateCaption('video1', 'simplified-characters', 'subtitle-display-1');
    updateCaption('video1', 'English', 'subtitle-display-2');
  }, 0);

  if (window.innerWidth <= 768) {
    $('.subtitle-display').insertAfter($('.video-container'))
  } else {
    $('.subtitle-display').insertAfter($('.main-player'))
  };

  window.onresize = function(event) {
    if (window.innerWidth <= 768) {
      $('.subtitle-display').insertAfter($('.video-container'))
    } else {
      $('.subtitle-display').insertAfter($('.main-player'))
    };
  };

  $("#menu-toggle").click(function(e) {
    e.preventDefault();
    $("#wrapper").toggleClass("toggled");
  });
  var trigger = $('.hamburger'), isClosed = false;
  trigger.click(function(e) {
    e.preventDefault();
    $("#wrapper").toggleClass("toggled");
    hamburger_cross();
  });
  function hamburger_cross() {
    if (isClosed == true) {
      trigger.removeClass('is-open');
      trigger.addClass('is-closed');
      isClosed = false;
    } else {
      trigger.removeClass('is-closed');
      trigger.addClass('is-open');
      isClosed = true;
    }
  }
  // Add slideDown animation to Bootstrap dropdown when expanding.
  $('.dropdown').on('show.bs.dropdown', function() {
    $(this).find('.dropdown-menu').first().stop(true, true).slideDown();
  });

  // Add slideUp animation to Bootstrap dropdown when collapsing.
  $('.dropdown').on('hide.bs.dropdown', function() {
    $(this).find('.dropdown-menu').first().stop(true, true).slideUp();
  });
</script>
